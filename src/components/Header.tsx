import { useState } from "react";
import { Link, useLocation, useNavigate } from "react-router-dom";
import { Menu, X, User, Wallet, Bell, Search, ChevronDown, LogOut } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import Logo from "@/assets/betnexa official logo .jpeg";
import { useBets } from "@/context/BetContext";
import { useUser } from "@/context/UserContext";

const sports = [
  { name: "Football", path: "/", emoji: "‚öΩ" },
  { name: "Basketball", path: "/basketball", emoji: "üèÄ" },
  { name: "Tennis", path: "/tennis", emoji: "üéæ" },
  { name: "Cricket", path: "/cricket", emoji: "üèè" },
  { name: "Boxing", path: "/boxing", emoji: "ü•ä" },
];

export function Header() {
  const [menuOpen, setMenuOpen] = useState(false);
  const location = useLocation();
  const navigate = useNavigate();
  const { balance } = useBets();
  const { isLoggedIn, logout, user } = useUser();

  const handleLogout = () => {
    logout();
    navigate("/login");
  };

  return (
    <header className="sticky top-0 z-50 border-b border-border/50 bg-background/95 backdrop-blur-md">
      <div className="container mx-auto flex h-16 items-center justify-between px-4">
        {/* Logo */}
        <Link to="/" className="flex items-center gap-2">
          <img src={Logo} alt="BETNEXA Logo" className="h-12 w-12" />
          <span className="font-display text-xl font-bold tracking-wider text-foreground hidden sm:inline">
            BET<span className="text-primary">NEXA</span>
          </span>
        </Link>

        {/* Desktop Nav */}
        <nav className="hidden items-center gap-1 md:flex">
          {sports.map((sport) => (
            <div
              key={sport.name}
              className={`flex items-center gap-1.5 rounded-lg px-3 py-2 text-sm font-medium transition-colors opacity-50 cursor-not-allowed ${
                location.pathname === sport.path
                  ? "bg-primary/10 text-primary"
                  : "text-muted-foreground"
              }`}
            >
              <span>{sport.emoji}</span>
              {sport.name}
            </div>
          ))}
          <div
            className="ml-1 flex items-center gap-1.5 rounded-lg px-3 py-2 text-sm font-medium opacity-50 cursor-not-allowed"
            style={{ color: "var(--live)" }}
          >
            <span className="pulse-live inline-block h-2 w-2 rounded-full bg-live" />
            Live
          </div>
        </nav>

        {/* Right actions */}
        <div className="flex items-center gap-2">
          <div className="hidden items-center gap-3 md:flex">
            <Button variant="ghost" size="icon" disabled className="opacity-50 cursor-not-allowed pointer-events-none">
              <Search className="h-4 w-4" />
            </Button>
            <Button variant="ghost" size="icon" className="relative opacity-50 cursor-not-allowed pointer-events-none" disabled>
              <Bell className="h-4 w-4" />
              <span className="absolute right-1.5 top-1.5 h-2 w-2 rounded-full bg-live" />
            </Button>
            {isLoggedIn && (
              <div className="flex items-center gap-2 rounded-lg bg-secondary px-3 py-1.5">
                <Wallet className="h-4 w-4 text-primary" />
                <span className="text-sm font-bold text-foreground">KSH {balance.toLocaleString()}</span>
              </div>
            )}
            {isLoggedIn && user?.isAdmin && (
              <Link to="/muleiadmin">
                <Button variant="outline" size="sm" className="text-orange-500 border-orange-500 hover:bg-orange-500/10">
                  üîê Admin
                </Button>
              </Link>
            )}
            {isLoggedIn && (
              <Button variant="destructive" size="sm" onClick={handleLogout}>
                <LogOut className="mr-1 h-4 w-4" />
                Logout
              </Button>
            )}
          </div>
          <div className="flex items-center gap-2 md:hidden">
            {isLoggedIn && (
              <div className="flex items-center gap-1.5 rounded-lg bg-secondary px-2 py-1.5">
                <Wallet className="h-4 w-4 text-primary" />
                <span className="text-xs font-bold text-foreground">KSH {balance.toLocaleString()}</span>
              </div>
            )}
            <button
              className="text-foreground"
              onClick={() => setMenuOpen(!menuOpen)}
            >
              {menuOpen ? <X className="h-6 w-6" /> : <Menu className="h-6 w-6" />}
            </button>
          </div>
        </div>
      </div>

      {/* Mobile menu */}
      {menuOpen && (
        <div className="animate-fade-up border-t border-border bg-background px-4 py-4 md:hidden">
          <div className="flex flex-col gap-2">
            {sports.map((sport) => (
              <div
                key={sport.name}
                className="flex items-center gap-2 rounded-lg px-3 py-2 text-sm opacity-50 cursor-not-allowed"
              >
                <span>{sport.emoji}</span>
                {sport.name}
              </div>
            ))}
            {isLoggedIn && user?.isAdmin && (
              <Link to="/muleiadmin" onClick={() => setMenuOpen(false)}>
                <Button variant="outline" size="sm" className="w-full text-orange-500 border-orange-500 hover:bg-orange-500/10">
                  üîê Admin Panel
                </Button>
              </Link>
            )}
            {isLoggedIn && (
              <button
                className="flex items-center gap-2 rounded-lg px-3 py-2 text-sm text-destructive hover:bg-secondary w-full"
                onClick={() => {
                  handleLogout();
                  setMenuOpen(false);
                }}
              >
                <LogOut className="h-4 w-4" />
                Logout
              </button>
            )}
          </div>
        </div>
      )}
    </header>
  );
}
